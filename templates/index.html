<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gooal Scanner - Monitor</title>
</head>
<body>
<h1>Gooal Scanner</h1>
<p>Status: <span id="status">carregando...</span></p>
<div id="matches"></div>

<script>
async function fetchHealth() {
  try {
    const res = await fetch('/health');
    const json = await res.json();
    document.getElementById('status').textContent = json.status === 'ok' ? 'online' : 'offline';
  } catch {
    document.getElementById('status').textContent = 'offline';
  }
}

async function fetchLiveMatches() {
  try {
    const res = await fetch('/live-matches');
    if (!res.ok) throw new Error('Erro ao buscar partidas');
    const matches = await res.json();
    const container = document.getElementById('matches');
    container.innerHTML = '';

    if (matches.length === 0) {
      container.textContent = 'Sem jogos ao vivo no momento.';
      return;
    }

    matches.forEach(match => {
      const home = match.homeTeam.name;
      const away = match.awayTeam.name;
      const scoreHome = match.homeScore?.current || 0;
      const scoreAway = match.awayScore?.current || 0;

      const div = document.createElement('div');
      div.textContent = `${home} ${scoreHome} x ${scoreAway} ${away}`;
      container.appendChild(div);
    });
  } catch {
    document.getElementById('matches').textContent = 'Erro ao carregar jogos.';
  }
}

function init() {
  fetchHealth();
  fetchLiveMatches();
  setInterval(fetchHealth, 60000);       // Atualiza status a cada 1 min
  setInterval(fetchLiveMatches, 10000);  // Atualiza partidas a cada 10s
}

window.onload = init;
</script>
</body>
</html>

